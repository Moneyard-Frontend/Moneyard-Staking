<!DOCTYPE html>
<html lang="en">
<head>
    <title>Moneyard Secure Staking</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Style Integration -->
    <style>
    :root {
        --primary-blue: #0066cc;
        --trust-green: #009933;
        --neutral-gray: #444444;
        --error-red: #cc0000;
    }

    body {
        background: white;
        color: var(--neutral-gray);
        font-family: 'Arial', sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 30px;
        line-height: 1.6;
    }

    .auth-section, .transaction-section {
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 30px;
        margin: 30px 0;
    }

    button, input {
        padding: 12px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 6px;
        width: 100%;
        box-sizing: border-box;
    }

    button {
        background: var(--trust-green);
        color: white;
        cursor: pointer;
        transition: background 0.3s;
    }

    button:hover {
        background: #00802b;
    }

    .tx-history {
        margin-top: 30px;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    </style>

    <!-- Required Libraries -->
    <script src="https://cdn.ethers.io/lib/ethers-5.6.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <header>
        <h1>üí∞ Moneyard Secure Staking</h1>
        <div class="security-badge">
            üîí SSL Secured | üõ°Ô∏è Insured Assets
        </div>
    </header>

    <!-- Auth Section -->
    <div class="auth-section">
        <button onclick="connectWallet()">üîó Connect Wallet</button>
        <div id="2fa-container" style="display: none; margin-top: 15px;">
            <input type="text" id="2fa-code" placeholder="6-digit code">
            <button onclick="verify2FA()">Verify</button>
        </div>
        
        <div style="margin-top: 20px;">
            <p>USDT Balance: <strong id="usdt-balance">0.00</strong></p>
            <p>ETH Price: $<strong id="eth-price">0.00</strong></p>
        </div>
    </div>

    <!-- Staking Interface -->
    <div class="transaction-section">
        <h2>Staking Dashboard</h2>
        <input type="number" id="stake-amount" placeholder="Amount (USDT)">
        <button onclick="stakeTokens()">Deposit</button>
        <input type="text" id="referral-code" placeholder="Referral Code (optional)" style="margin-top: 15px;">
    </div>

    <!-- Transaction History -->
    <div class="tx-history">
        <h3>Recent Transactions</h3>
        <div id="tx-list"></div>
    </div>

    <script>
    // Configuration (Set in Fleek Environment Variables)
    const USDT_CONTRACT = '0xdAC17F958D2ee523a2206206994597C13D831ec7';
    const ERC20_ABI = [/* USDT ABI Here */];
    let provider, signer, userAddress;

    async function connectWallet() {
        try {
            if (!window.ethereum) throw new Error("Wallet not found");
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            provider = new ethers.providers.Web3Provider(window.ethereum);
            signer = provider.getSigner();
            userAddress = await signer.getAddress();
            init2FA();
            updateBalances();
            setupEventListeners();
        } catch (error) {
            alert(error.message);
        }
    }

    async function updateBalances() {
        try {
            // USDT Balance
            const usdtContract = new ethers.Contract(USDT_CONTRACT, ERC20_ABI, signer);
            const balance = await usdtContract.balanceOf(userAddress);
            document.getElementById('usdt-balance').textContent = 
                (balance / 1e6).toFixed(2);

            // ETH Price
            const priceData = await axios.get(
                'https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd'
            );
            document.getElementById('eth-price').textContent = 
                priceData.data.ethereum.usd.toFixed(2);
        } catch (error) {
            console.error(error);
        }
    }

    async function stakeTokens() {
        const amount = document.getElementById('stake-amount').value;
        const referralCode = document.getElementById('referral-code').value;
        try {
            const usdtContract = new ethers.Contract(USDT_CONTRACT, ERC20_ABI, signer);
            const tx = await usdtContract.transfer(
                'YOUR_STAKING_CONTRACT_ADDRESS',
                ethers.utils.parseUnits(amount, 6)
            );
            await tx.wait();
            updateBalances();
            if(referralCode) localStorage.setItem('referral', referralCode);
        } catch (error) {
            alert('Transaction failed: ' + error.message);
        }
    }

    function setupEventListeners() {
        const usdtContract = new ethers.Contract(USDT_CONTRACT, ERC20_ABI, provider);
        usdtContract.on('Transfer', (from, to, value) => {
            if(from.toLowerCase() === userAddress.toLowerCase() || 
               to.toLowerCase() === userAddress.toLowerCase()) {
                const txElement = document.createElement('div');
                txElement.innerHTML = `
                    <p>${new Date().toLocaleString()} - 
                    ${ethers.utils.formatUnits(value, 6)} USDT</p>
                `;
                document.getElementById('tx-list').prepend(txElement);
            }
        });
    }

    // 2FA Implementation
    function init2FA() {
        const phone = prompt("Enter phone for SMS verification:");
        if (phone) {
            document.getElementById('2fa-container').style.display = 'block';
        }
    }

    async function verify2FA() {
        const code = document.getElementById('2fa-code').value;
        if (!/^\d{6}$/.test(code)) return alert('Invalid code');
        alert('2FA Verified!'); // Replace with actual verification
    }

    // Auto-refresh every 60 seconds
    setInterval(updateBalances, 60000);
    </script>
</body>
</html>
