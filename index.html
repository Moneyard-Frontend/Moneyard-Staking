<!DOCTYPE html>
<html lang="en">
<head>
    <title>Moneyard Secure Staking</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Style Integration -->
    <style>
    :root {
        --primary-blue: #0066cc;
        --trust-green: #009933;
        --neutral-gray: #444444;
        --error-red: #cc0000;
    }

    body {
        background: white;
        color: var(--neutral-gray);
        font-family: 'Arial', sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 30px;
        line-height: 1.6;
    }

    /* Enhanced Security Features */
    .auth-section {
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 30px;
        margin: 30px 0;
        position: relative;
    }

    .2fa-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255,255,255,0.9);
        display: none;
        padding: 20px;
    }

    /* Password Recovery */
    .recovery-options {
        margin-top: 15px;
        font-size: 0.9em;
    }

    /* Loading States */
    .loading {
        position: relative;
        opacity: 0.7;
        pointer-events: none;
    }

    .loading::after {
        content: "‚è≥";
        animation: spin 1s linear infinite;
        position: absolute;
        right: 10px;
    }

    @keyframes spin {
        100% { transform: rotate(360deg); }
    }

    /* Existing styles from both versions integrated here */
    </style>

    <!-- Required Libraries -->
    <script src="https://cdn.ethers.io/lib/ethers-5.6.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <header>
        <h1>üí∞ Moneyard Secure Staking</h1>
        <div class="security-badge">
            üîí SSL Secured | üõ°Ô∏è Insured Assets
        </div>
    </header>

    <!-- Enhanced Auth Section -->
    <div class="auth-section">
        <div id="login-container">
            <h2 style="color: var(--primary-blue);">Secure Access</h2>
            
            <!-- Login Form -->
            <div id="email-login">
                <input type="email" id="loginEmail" placeholder="Email Address">
                <input type="password" id="loginPassword" placeholder="Password">
                <button onclick="initLogin()">üîë Login</button>
                <div class="recovery-options">
                    <a href="#forgot-password" onclick="showRecovery()">Forgot Password?</a> |
                    <a href="#signup" onclick="showSignup()">Create Account</a>
                </div>
            </div>

            <!-- Wallet Login -->
            <div style="margin-top: 20px;">
                <button onclick="connectWallet()">üîó Connect Wallet</button>
            </div>

            <!-- 2FA Verification -->
            <div id="2fa-container" class="2fa-overlay">
                <h3>2FA Verification</h3>
                <input type="text" id="2fa-code" placeholder="6-digit code">
                <button onclick="verify2FA()">Verify</button>
                <button onclick="cancel2FA()">Cancel</button>
            </div>
        </div>

        <!-- Password Recovery -->
        <div id="recovery-container" style="display: none;">
            <h3>Password Recovery</h3>
            <input type="email" id="recoveryEmail" placeholder="Registered Email">
            <button onclick="sendRecovery()">Send Reset Link</button>
            <div id="recovery-2fa" style="display: none; margin-top: 15px;">
                <input type="text" id="recovery-code" placeholder="2FA Code">
                <button onclick="confirmRecovery()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Rest of your existing interface remains similar with enhanced security -->

    <!-- Integrated Blockchain Script -->
    <script>
    // Security Constants
    const CONTRACT_ADDRESS = '0x...'; // Replace with actual
    const USDT_CONTRACT = '0xdAC17F958D2ee523a2206206994597C13D831ec7';
    const API_ENDPOINT = 'https://api.moneyard.com/v1'; // Your backend

    // State Management
    let authToken = null;
    let tempSession = null;

    // Enhanced Login Flow
    async function initLogin() {
        try {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Add validation
            if (!validateEmail(email) || password.length < 8) {
                showError('Invalid credentials');
                return;
            }

            const response = await axios.post(`${API_ENDPOINT}/auth/login`, {
                email,
                password
            });

            if (response.data.requires2FA) {
                show2FA();
                tempSession = response.data.tempToken;
            }
        } catch (error) {
            handleAuthError(error);
        }
    }

    // Password Recovery Flow
    async function sendRecovery() {
        const email = document.getElementById('recoveryEmail').value;
        if (!validateEmail(email)) return;

        try {
            await axios.post(`${API_ENDPOINT}/auth/recover`, { email });
            document.getElementById('recovery-2fa').style.display = 'block';
        } catch (error) {
            handleAuthError(error);
        }
    }

    // Enhanced Wallet Connection
    async function connectWallet() {
        try {
            if (typeof window.ethereum === 'undefined') {
                throw new Error('Wallet not found');
            }

            await window.ethereum.request({ method: 'eth_requestAccounts' });
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            const address = await signer.getAddress();
            
            // Init 2FA for wallet connection
            show2FA();
            await verifyWalletSession(address);
        } catch (error) {
            handleAuthError(error);
        }
    }

    // 2FA Verification
    async function verify2FA() {
        const code = document.getElementById('2fa-code').value;
        if (!/^\d{6}$/.test(code)) {
            showError('Invalid 2FA code');
            return;
        }

        try {
            const response = await axios.post(`${API_ENDPOINT}/auth/verify-2fa`, {
                code,
                tempSession
            });

            authToken = response.data.token;
            initializeSession();
        } catch (error) {
            handleAuthError(error);
        }
    }

    // Session Management
    function initializeSession() {
        // Store token securely
        sessionStorage.setItem('authToken', authToken);
        loadUserData();
        setupSessionTimer();
    }

    // Security Helpers
    function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function handleAuthError(error) {
        console.error('Auth Error:', error);
        showError(error.response?.data?.message || 'Authentication failed');
    }

    function showError(message) {
        // Implement error display
    }
    </script>

    <!-- Existing Transaction and Staking Logic Here -->
</body>
</html>
